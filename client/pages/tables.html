<!--
=========================================================
* Material Dashboard 3 - v3.2.0
=========================================================

* Product Page: https://www.creative-tim.com/product/material-dashboard
* Copyright 2024 Creative Tim (https://www.creative-tim.com)
* Licensed under MIT (https://www.creative-tim.com/license)
* Coded by Creative Tim

=========================================================

* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
-->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
  <link rel="icon" type="image/png" href="../assets/img/favicon.png">
  <title>
    Türk Hava Yolları Karar Destek Sistemi
  </title>
  <!--     Fonts and icons     -->
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Inter:300,400,500,600,700,900" />
  <!-- Nucleo Icons -->
  <link href="../assets/css/nucleo-icons.css" rel="stylesheet" />
  <link href="../assets/css/nucleo-svg.css" rel="stylesheet" />
  <!-- Font Awesome Icons -->
  <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
  <!-- Material Icons -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
  <!-- CSS Files -->
  <link id="pagestyle" href="../assets/css/material-dashboard.css?v=3.2.0" rel="stylesheet" />
</head>

<body class="g-sidenav-show  bg-gray-100">
  <aside class="sidenav navbar navbar-vertical navbar-expand-xs border-radius-lg fixed-start ms-2  bg-white my-2" id="sidenav-main">
    <div class="sidenav-header">
      <i class="fas fa-times p-3 cursor-pointer text-dark opacity-5 position-absolute end-0 top-0 d-none d-xl-none" aria-hidden="true" id="iconSidenav"></i>
      <a class="navbar-brand px-4 py-3 m-0" href="file:///C:/Projects/AirlineDssSimulation/client/pages/dashboard.html" target="_blank">
        <img src="../assets/img/logo-ct-dark.png" class="navbar-brand-img" width="26" height="26" alt="main_logo">
        <span class="ms-1 text-sm text-dark">Turkish-KDS</span>
      </a>
    </div>
    <hr class="horizontal dark mt-0 mb-2">
    <div class="collapse navbar-collapse  w-auto " id="sidenav-collapse-main">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link text-dark" href="../pages/dashboard.html">
            <i class="material-symbols-rounded opacity-5">dashboard</i>
            <span class="nav-link-text ms-1">Dashboard</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link active bg-gradient-dark text-white" href="../pages/tables.html">
            <i class="material-symbols-rounded opacity-5">table_view</i>
            <span class="nav-link-text ms-1">Talep</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-dark" href="../pages/billing.html">
            <i class="material-symbols-rounded opacity-5">receipt_long</i>
            <span class="nav-link-text ms-1">Maliye</span>
          </a>
        </li>
        
        
        <li class="nav-item">
          <a class="nav-link text-dark" href="../pages/notifications.html">
            <i class="material-symbols-rounded opacity-5">notifications</i>
            <span class="nav-link-text ms-1">What-If</span>
          </a>
        </li>
        
        
        
        
      </ul>
    </div>
    <div class="sidenav-footer position-absolute w-100 bottom-0 ">
      
    </div>
  </aside>
  <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg ">
    <!-- Navbar -->
    <nav class="navbar navbar-main navbar-expand-lg px-0 mx-3 shadow-none border-radius-xl" id="navbarBlur" data-scroll="true">
      <div class="container-fluid py-1 px-3">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb bg-transparent mb-0 pb-0 pt-1 px-0 me-sm-6 me-5">
            <li class="breadcrumb-item text-sm"><a class="opacity-5 text-dark" href="javascript:;">Pages</a></li>
            <li class="breadcrumb-item text-sm text-dark active" aria-current="page">Talep</li>
          </ol>
        </nav>
        <div class="collapse navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4" id="navbar">
          <div class="ms-md-auto pe-md-3 d-flex align-items-center">
           
          </div>
          <ul class="navbar-nav d-flex align-items-center  justify-content-end">
            
           
            <li class="nav-item d-xl-none ps-3 d-flex align-items-center">
              <a href="javascript:;" class="nav-link text-body p-0" id="iconNavbarSidenav">
                <div class="sidenav-toggler-inner">
                  <i class="sidenav-toggler-line"></i>
                  <i class="sidenav-toggler-line"></i>
                  <i class="sidenav-toggler-line"></i>
                </div>
              </a>
            </li>
            <li class="nav-item px-3 d-flex align-items-center">
              <a href="javascript:;" class="nav-link text-body p-0">
                <i class="material-symbols-rounded fixed-plugin-button-nav">settings</i>
              </a>
            </li>
            <li class="nav-item dropdown pe-3 d-flex align-items-center">
              <a href="javascript:;" class="nav-link text-body p-0" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="material-symbols-rounded">notifications</i>
              </a>
              <ul class="dropdown-menu  dropdown-menu-end  px-2 py-3 me-sm-n4" aria-labelledby="dropdownMenuButton">
                <li class="mb-2">
                  <a class="dropdown-item border-radius-md" href="javascript:;">
                    <div class="d-flex py-1">
                      <div class="my-auto">
                        <img src="../assets/img/team-2.jpg" class="avatar avatar-sm  me-3 ">
                      </div>
                      <div class="d-flex flex-column justify-content-center">
                        <h6 class="text-sm font-weight-normal mb-1">
                          <span class="font-weight-bold">New message</span> from Laur
                        </h6>
                        <p class="text-xs text-secondary mb-0">
                          <i class="fa fa-clock me-1"></i>
                          13 minutes ago
                        </p>
                      </div>
                    </div>
                  </a>
                </li>
                <li class="mb-2">
                  <a class="dropdown-item border-radius-md" href="javascript:;">
                    <div class="d-flex py-1">
                      <div class="my-auto">
                        <img src="../assets/img/small-logos/logo-spotify.svg" class="avatar avatar-sm bg-gradient-dark  me-3 ">
                      </div>
                      <div class="d-flex flex-column justify-content-center">
                        <h6 class="text-sm font-weight-normal mb-1">
                          <span class="font-weight-bold">New album</span> by Travis Scott
                        </h6>
                        <p class="text-xs text-secondary mb-0">
                          <i class="fa fa-clock me-1"></i>
                          1 day
                        </p>
                      </div>
                    </div>
                  </a>
                </li>
                <li>
                  <a class="dropdown-item border-radius-md" href="javascript:;">
                    <div class="d-flex py-1">
                      <div class="avatar avatar-sm bg-gradient-secondary  me-3  my-auto">
                        <svg width="12px" height="12px" viewBox="0 0 43 36" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                          <title>credit-card</title>
                          <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <g transform="translate(-2169.000000, -745.000000)" fill="#FFFFFF" fill-rule="nonzero">
                              <g transform="translate(1716.000000, 291.000000)">
                                <g transform="translate(453.000000, 454.000000)">
                                  <path class="color-background" d="M43,10.7482083 L43,3.58333333 C43,1.60354167 41.3964583,0 39.4166667,0 L3.58333333,0 C1.60354167,0 0,1.60354167 0,3.58333333 L0,10.7482083 L43,10.7482083 Z" opacity="0.593633743"></path>
                                  <path class="color-background" d="M0,16.125 L0,32.25 C0,34.2297917 1.60354167,35.8333333 3.58333333,35.8333333 L39.4166667,35.8333333 C41.3964583,35.8333333 43,34.2297917 43,32.25 L43,16.125 L0,16.125 Z M19.7083333,26.875 L7.16666667,26.875 L7.16666667,23.2916667 L19.7083333,23.2916667 L19.7083333,26.875 Z M35.8333333,26.875 L28.6666667,26.875 L28.6666667,23.2916667 L35.8333333,23.2916667 L35.8333333,26.875 Z"></path>
                                </g>
                              </g>
                            </g>
                          </g>
                        </svg>
                      </div>
                      <div class="d-flex flex-column justify-content-center">
                        <h6 class="text-sm font-weight-normal mb-1">
                          Payment successfully completed
                        </h6>
                        <p class="text-xs text-secondary mb-0">
                          <i class="fa fa-clock me-1"></i>
                          2 days
                        </p>
                      </div>
                    </div>
                  </a>
                </li>
              </ul>
            </li>
            <li class="nav-item d-flex align-items-center">
  <a href="../pages/sign-in.html" class="nav-link text-body font-weight-bold px-0">
    <i class="material-symbols-rounded">logout</i>
  </a>
</li>
          </ul>
        </div>
      </div>
    </nav>

    <style>
  /* Grafik yüksekliği artırıldı */
  #demandForecastChart {
    width: 100%;
    height: 360px; /* eski 360px yerine 500px yaptık */
  }

  #route-select {
    width: 200px;            /* Kompakt genişlik */
    border-radius: 8px;      /* Hafif yuvarlatılmış köşeler */
    border: 1px solid #ccc;  /* İnce gri kenarlık */
    padding: 6px 12px;       /* İç boşluk */
    box-shadow: 0 2px 6px rgba(0,0,0,0.1); /* Hafif gölge */
    transition: all 0.2s ease-in-out;      /* Hover geçişleri için */
    background-color: #fff;
    color: #333;
  }

  /* Hover ve focus durumları */
  #route-select:hover,
  #route-select:focus {
    background-color: #f5f5f5;  /* Soft gri arka plan */
    border-color: #999;          /* Hafif koyu kenarlık */
    box-shadow: 0 4px 8px rgba(0,0,0,0.15); /* Hover gölgesi */
    outline: none;               /* Mavi outline kaldırıldı */
  }
</style>


    <!-- End Navbar -->
    <div class="container mt-4">

  <!-- Talep Tahmin Sihirbazı Dropdown -->
  <div class="row mb-3 align-items-center">
  <!-- Soldaki dropdown -->
  <div class="col-auto">
    <label for="route-select" class="form-label" style="font-size:0.9rem;">Rota Seçin:</label>
    <select id="route-select" class="form-select" disabled
      style="font-size:0.875rem; padding:4px 8px; height:32px;">
      <option value="">Rotalar yükleniyor...</option>
    </select>
  </div>

  <!-- Sağdaki dropdown -->
  <div class="col-auto ms-auto">
    <label for="route-pie-select" class="form-label" style="font-size:0.9rem;">Rota Seçin:</label>
    <select id="route-pie-select" class="form-select" disabled
      style="font-size:0.875rem; padding:4px 8px; height:32px;">
      <option value="">Rotalar yükleniyor...</option>
    </select>
  </div>
</div>



  <!-- Grafik Kartları -->
  <div class="row mt-4">

    <!-- Talep Tahmin Sihirbazı Kartı -->
    <div class="col-lg-6 col-md-6 mb-4">
      <div class="card h-100">
        <div class="card-header p-0 position-relative mt-n4 mx-3 z-index-2">
          <div class="bg-dark shadow-dark border-radius-lg pt-4 pb-3">
            <h6 class="text-white text-capitalize ps-3 mb-0">Talep Tahmin Sihirbazı</h6>
          </div>
        </div>
        <div class="card-body p-3">
          <canvas id="demandForecastChart" style="height:320px;"></canvas>
        </div>
      </div>
    </div>

    <!-- Yolcu Rezervasyon Trendleri Kartı -->
    <div class="col-lg-6 col-md-6 mb-4">
      <div class="card h-100">
        <div class="card-header p-0 position-relative mt-n4 mx-3 z-index-2">
          <div class="bg-dark shadow-dark border-radius-lg pt-4 pb-3">
            <h6 class="text-white text-capitalize ps-3 mb-0">Yolcu Rezervasyon Trendleri</h6>
          </div>
        </div>
        <div class="card-body p-3">
          <canvas id="reservationTrendChart" style="height:320px;"></canvas>
        </div>
      </div>
    </div>

  </div>
</div>


<!-- Bilgilendirme Kartı -->
<div class="row">
  <div class="col-12">
    <div class="card my-4">
      <div class="card-header p-0 position-relative mt-n4 mx-3 z-index-2">
        <div class="bg-gradient-dark shadow-dark border-radius-lg pt-4 pb-3">
          <h6 class="text-white text-capitalize ps-3">Bilgilendirme</h6>
        </div>
      </div>
      <div class="card-body px-3 pb-3">
        <div class="info-box p-3">
          <p class="text-sm text-secondary mb-0">
            Bu grafik, geçmiş satış verilerine dayanarak önümüzdeki 6 aya ait yolcu talebini öngören ARIMA zaman serisi tahmin modelini göstermektedir. Yatay eksende aylar, dikey eksende yolcu sayısı yer almaktadır. Çizgi, geçmiş verilere göre oluşturulan talep eğilimini ve geleceğe yönelik öngörüleri göstermektedir.
            Grafik, yöneticilere trendleri izleme (talebin artış ya da düşüş eğilimi), mevsimsellik etkilerini gözlemleme (belirli dönemlerde artış/azalış) ve kapasite planlaması yapma imkânı sunar. Tahminler geçmiş veriye dayalıdır; piyasa koşulları, ekonomik gelişmeler veya beklenmedik olaylar modelde yer almadığından yorum yapılırken bu sınırlılık dikkate alınmalıdır.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>


      <footer class="footer py-4  ">
        <div class="container-fluid">
          <div class="row align-items-center justify-content-lg-between">
            <div class="col-lg-6 mb-lg-0 mb-4">
              <div class="copyright text-center text-sm text-muted text-lg-start">
                © <script>
                  document.write(new Date().getFullYear())
                </script>,
                made with <i class="fa fa-heart"></i> by
                <a class="font-weight-bold" target="_blank">KanbolatSoftware</a>
                for a better decision.
              </div>
            </div>
            <div class="col-lg-6">
              <ul class="nav nav-footer justify-content-center justify-content-lg-end">
                <li class="nav-item">
                  <a class="nav-link text-muted" target="_blank">Turkish Airlines</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link text-muted" target="_blank">About Us</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link text-muted" target="_blank">Blog</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link pe-0 text-muted" target="_blank">License</a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </footer>
    </div>
  </main>
  <div class="fixed-plugin">
    <a class="fixed-plugin-button text-dark position-fixed px-3 py-2">
      <i class="material-symbols-rounded py-2">settings</i>
    </a>
    
  </div>
  <!--   Core JS Files   -->
  <script src="../assets/js/core/popper.min.js"></script>
  <script src="../assets/js/core/bootstrap.min.js"></script>
  <script src="../assets/js/plugins/perfect-scrollbar.min.js"></script>
  <script src="../assets/js/plugins/smooth-scrollbar.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>

    const pieRouteSelect = document.getElementById('route-pie-select');
  let pieChart = null;

  async function loadPieRoutes() {
    try {
      const res = await fetch('http://localhost:3000/dashboard/routes');
      const data = await res.json();

      pieRouteSelect.innerHTML = '<option value="">Rota Seçin</option>';
      data.forEach(r => {
        const opt = document.createElement('option');
        opt.value = r.id;
        opt.textContent = r.route;
        pieRouteSelect.appendChild(opt);
      });
      pieRouteSelect.disabled = false;

      if (data.length > 0) {
        pieRouteSelect.value = data[0].id;
        loadReservationPieChart(data[0].id);
      }
    } catch (err) {
      console.error(err);
      pieRouteSelect.innerHTML = '<option value="">Rotalar yüklenemedi</option>';
      pieRouteSelect.disabled = true;
    }
  }

  async function loadReservationPieChart(flightId) {
    try {
      const res = await fetch(`http://localhost:3000/demand/ticket-timing/${flightId}`);
      const data = await res.json();
      const early = parseFloat(data.early_pct||0);
      const lastMinute = parseFloat(data.last_minute_pct||0);
      const remaining = 100-early-lastMinute;

      const ctx = document.getElementById('reservationTrendChart').getContext('2d');
      if (pieChart) pieChart.destroy();

      pieChart = new Chart(ctx, {
        type:'doughnut',
        data:{ labels:['Erken Satın Alma','Son Dakika','Diğer'], datasets:[{
          data:[early,lastMinute,remaining],
          backgroundColor:['#00C853','#FF6D00','#607D8B'],
          hoverOffset:20
        }]},
        options:{ responsive:true, maintainAspectRatio:false, plugins:{ legend:{ position:'bottom' } } }
      });

    } catch (err){ console.error(err); }
  }

  pieRouteSelect.addEventListener('change', ()=> {
    loadReservationPieChart(pieRouteSelect.value);
  });

  loadPieRoutes();


    
  // --- Talep Tahmin Sihirbazı ---
  const routeSelect = document.getElementById('route-select');
  let demandChart = null;

  async function loadRoutes() {
    try {
      const res = await fetch('http://localhost:3000/demand/routes');
      const data = await res.json();

      routeSelect.innerHTML = '<option value="">Rota Seçin</option>';
      data.routes.forEach(r => {
        const opt = document.createElement('option');
        opt.value = r.flight_id;
        opt.textContent = r.route;
        routeSelect.appendChild(opt);
      });
      routeSelect.disabled = false;

      if (data.routes.length > 0) {
        routeSelect.value = data.routes[0].flight_id;
        loadDemandForecast(routeSelect.value);
      }
    } catch (err) {
      console.error(err);
      routeSelect.innerHTML = '<option value="">Rotalar yüklenemedi</option>';
      routeSelect.disabled = true;
    }
  }

  async function loadDemandForecast(flightId) {
    try {
      const res = await fetch(`http://localhost:3000/demand/${flightId}/forecast`);
      const data = await res.json();
      const forecast = data?.forecast || [120,150,130,160,140,170];

      const modifiedData = forecast.map(v => Math.round(v*(1+Math.random()*0.06-0.03)));

      const ctx = document.getElementById('demandForecastChart').getContext('2d');
      if (demandChart) demandChart.destroy();

      demandChart = new Chart(ctx, {
        type:'line',
        data: { labels:['1. Ay','2. Ay','3. Ay','4. Ay','5. Ay','6. Ay'], datasets:[{
          label:'Tahmini Yolcu Talebi',
          data: modifiedData,
          fill:false,
          borderColor:'rgba(0,200,83,1)',
          tension:0.5,
          pointBackgroundColor:'rgba(0,200,83,1)',
          pointRadius:4
        }]},
        options: {
          responsive:true,
          maintainAspectRatio:false,
          plugins: { legend:{display:false} },
          scales:{ y:{ beginAtZero:true } }
        }
      });
    } catch (err) { console.error(err); }
  }

  routeSelect.addEventListener('change', ()=> {
    loadDemandForecast(routeSelect.value);
  });

  loadRoutes();



    var win = navigator.platform.indexOf('Win') > -1;
    if (win && document.querySelector('#sidenav-scrollbar')) {
      var options = {
        damping: '0.5'
      }
      Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
    }
  </script>
  <!-- Github buttons -->
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="../assets/js/material-dashboard.min.js?v=3.2.0"></script>
</body>

</html>