<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
  <link rel="icon" type="image/png" href="../assets/img/favicon.png">
  <title>Türk Hava Yolları Karar Destek Sistemi</title>

  <!-- Fonts and icons -->
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Inter:300,400,500,600,700,900" />
  <link href="../assets/css/nucleo-icons.css" rel="stylesheet" />
  <link href="../assets/css/nucleo-svg.css" rel="stylesheet" />
  <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
  <link id="pagestyle" href="../assets/css/material-dashboard.css?v=3.2.0" rel="stylesheet" />

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <style>
    /* Enhanced Custom Styles */
    :root {
      --primary-color: #1976d2;
      --success-color: #43a047;
      --warning-color: #fb8c00;
      --danger-color: #e53935;
      --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --gradient-success: linear-gradient(135deg, #43a047 0%, #66bb6a 100%);
      --gradient-warning: linear-gradient(135deg, #fb8c00 0%, #ffa726 100%);
      --gradient-danger: linear-gradient(135deg, #e53935 0%, #ef5350 100%);
      --shadow-soft: 0 2px 12px rgba(0,0,0,0.08);
      --shadow-hover: 0 6px 24px rgba(0,0,0,0.12);
    }

    body {
      font-family: 'Inter', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* Enhanced Card Animations */
    .card {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: none;
      box-shadow: var(--shadow-soft);
      overflow: hidden;
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-hover);
    }

    /* Stat Card Enhancements */
    .stat-card {
      position: relative;
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      height: 100%;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--gradient-primary);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .stat-card:hover::before {
      opacity: 1;
    }

    .stat-icon {
      width: 56px;
      height: 56px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .stat-card:hover .stat-icon {
      transform: scale(1.1) rotate(5deg);
    }

    /* Value Counter Animation */
    .stat-value {
      font-size: 1.75rem;
      font-weight: 700;
      color: #1a1a1a;
      margin: 0.5rem 0;
      line-height: 1.2;
    }

    .stat-label {
      font-size: 0.875rem;
      color: #6c757d;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 500;
    }

    .stat-change {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .stat-change.positive {
      background: rgba(67, 160, 71, 0.1);
      color: var(--success-color);
    }

    .stat-change.negative {
      background: rgba(229, 57, 53, 0.1);
      color: var(--danger-color);
    }

    /* Chart Container */
    .chart-container {
      position: relative;
      height: 300px;
      padding: 1rem;
    }

    /* Dropdown Styles */
    .custom-select {
      position: relative;
      display: inline-block;
    }

    .custom-select select {
      appearance: none;
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 8px 36px 8px 14px;
      font-size: 0.875rem;
      font-weight: 500;
      color: #333;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .custom-select select:hover {
      border-color: #bbb;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .custom-select select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1);
    }

    .custom-select::after {
      content: '▼';
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      pointer-events: none;
      font-size: 10px;
      color: #666;
    }

    /* Section Headers */
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .section-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: #1a1a1a;
      margin: 0;
    }

    .section-subtitle {
      font-size: 0.875rem;
      color: #6c757d;
      margin: 0.25rem 0 0;
    }

    /* Loading Animation */
    .loading-shimmer {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }

    @keyframes shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    /* Competitor Table */
    .competitor-table {
      width: 100%;
      margin-top: 1rem;
    }

    .competitor-table th {
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      color: #6c757d;
      padding: 0.75rem;
      border-bottom: 2px solid #e9ecef;
    }

    .competitor-table td {
      padding: 0.75rem;
      border-bottom: 1px solid #f0f0f0;
    }

    .competitor-table tbody tr {
      transition: background-color 0.2s ease;
    }

    .competitor-table tbody tr:hover {
      background-color: #f8f9fa;
    }

    /* Badge Styles */
    .status-badge {
      display: inline-flex;
      align-items: center;
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      gap: 6px;
    }

    .status-badge.excellent {
      background: rgba(67, 160, 71, 0.15);
      color: var(--success-color);
    }

    .status-badge.moderate {
      background: rgba(251, 140, 0, 0.15);
      color: var(--warning-color);
    }

    .status-badge.poor {
      background: rgba(229, 57, 53, 0.15);
      color: var(--danger-color);
    }

    /* Legend Styles */
    .legend-container {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-top: 1rem;
      justify-content: center;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.875rem;
      transition: transform 0.2s ease;
      cursor: pointer;
    }

    .legend-item:hover {
      transform: scale(1.05);
    }

    .legend-color {
      width: 14px;
      height: 14px;
      border-radius: 3px;
      flex-shrink: 0;
    }

    .legend-label {
      font-weight: 500;
      color: #333;
    }

    .legend-percent {
      color: #6c757d;
      font-weight: 600;
    }

    /* Responsive Grid */
    @media (max-width: 768px) {
      .stat-value {
        font-size: 1.5rem;
      }

      .chart-container {
        height: 250px;
      }
    }

    /* Smooth Page Load */
    .fade-in {
      animation: fadeIn 0.6s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Dashboard Welcome */
    .dashboard-welcome {
      margin-bottom: 2rem;
    }

    .dashboard-welcome h3 {
      font-size: 1.75rem;
      font-weight: 700;
      color: #1a1a1a;
      margin-bottom: 0.5rem;
    }

    .dashboard-welcome p {
      font-size: 1rem;
      color: #6c757d;
      line-height: 1.6;
    }

    /* Price Tag Highlight */
    .price-highlight {
      display: inline-block;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: 700;
      font-size: 1.1rem;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    /* Tooltip Enhancement */
    [data-tooltip] {
      position: relative;
      cursor: help;
    }

    [data-tooltip]::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      padding: 8px 12px;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      border-radius: 6px;
      font-size: 0.75rem;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      margin-bottom: 8px;
    }

    [data-tooltip]:hover::after {
      opacity: 1;
    }

    /* Leaflet Map Customization */
    #flightMap {
      position: relative;
      overflow: hidden;
    }

    .leaflet-popup-content-wrapper {
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .leaflet-popup-content {
      font-family: 'Inter', sans-serif;
      font-size: 0.875rem;
      line-height: 1.5;
      margin: 12px;
    }

    .map-popup-title {
      font-weight: 700;
      font-size: 1rem;
      color: #1a1a1a;
      margin-bottom: 6px;
    }

    .map-popup-detail {
      color: #6c757d;
      font-size: 0.85rem;
    }

    .map-popup-profit {
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px solid #e9ecef;
      font-weight: 600;
    }

    .map-popup-profit.positive {
      color: var(--success-color);
    }

    .map-popup-profit.negative {
      color: var(--danger-color);
    }

    .map-popup-profit.neutral {
      color: #6c757d;
    }
  </style>
</head>

<body class="g-sidenav-show bg-gray-100">

  <!-- Sidebar -->
  <aside class="sidenav navbar navbar-vertical navbar-expand-xs border-radius-lg fixed-start ms-2 bg-white my-2" id="sidenav-main">
    <div class="sidenav-header">
      <i class="fas fa-times p-3 cursor-pointer text-dark opacity-5 position-absolute end-0 top-0 d-none d-xl-none" aria-hidden="true" id="iconSidenav"></i>
      <a class="navbar-brand px-4 py-3 m-0" href="https://www.turkishairlines.com/tr-tr/bilgi-edin/bize-ulasin/" target="_blank">
        <img src="../assets/img/logo-ct-dark.png" class="navbar-brand-img" width="26" height="26" alt="main_logo">
        <span class="ms-1 text-sm text-dark">Turkish-KDS</span>
      </a>
    </div>
    <hr class="horizontal dark mt-0 mb-2">
    <div class="collapse navbar-collapse w-auto" id="sidenav-collapse-main">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link active bg-gradient-dark text-white" href="../pages/dashboard.html">
            <i class="material-symbols-rounded opacity-5">dashboard</i>
            <span class="nav-link-text ms-1">Dashboard</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-dark" href="../pages/tables.html">
            <i class="material-symbols-rounded opacity-5">table_view</i>
            <span class="nav-link-text ms-1">Talep</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-dark" href="../pages/billing.html">
            <i class="material-symbols-rounded opacity-5">receipt_long</i>
            <span class="nav-link-text ms-1">Maliye</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-dark" href="../pages/notifications.html">
            <i class="material-symbols-rounded opacity-5">notifications</i>
            <span class="nav-link-text ms-1">What-If</span>
          </a>
        </li>
      </ul>
    </div>
    <div class="sidenav-footer position-absolute w-100 bottom-0"></div>
  </aside>

  <!-- Main Content -->
  <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg">

    <!-- Navbar -->
    <nav class="navbar navbar-main navbar-expand-lg px-0 mx-3 shadow-none border-radius-xl" id="navbarBlur" data-scroll="true">
      <div class="container-fluid py-1 px-3">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb bg-transparent mb-0 pb-0 pt-1 px-0 me-sm-6 me-5">
            <li class="breadcrumb-item text-sm"><a class="opacity-5 text-dark" href="javascript:;">Pages</a></li>
            <li class="breadcrumb-item text-sm text-dark active" aria-current="page">Dashboard</li>
          </ol>
        </nav>
        <ul class="navbar-nav d-flex align-items-center justify-content-end">
          <li class="nav-item d-xl-none ps-3 d-flex align-items-center">
            <a href="javascript:;" class="nav-link text-body p-0" id="iconNavbarSidenav">
              <div class="sidenav-toggler-inner">
                <i class="sidenav-toggler-line"></i>
                <i class="sidenav-toggler-line"></i>
                <i class="sidenav-toggler-line"></i>
              </div>
            </a>
          </li>
          <li class="nav-item px-3 d-flex align-items-center">
            <a href="javascript:;" class="nav-link text-body p-0">
              <i class="material-symbols-rounded fixed-plugin-button-nav">settings</i>
            </a>
          </li>
          <li class="nav-item pe-3 d-flex align-items-center">
            <a href="https://mail.google.com" target="_blank" class="nav-link text-body p-0">
              <i class="material-symbols-rounded">mail</i>
            </a>
          </li>
          <li class="nav-item d-flex align-items-center">
            <a href="../pages/sign-in.html" class="nav-link text-body font-weight-bold px-0">
              <i class="material-symbols-rounded">logout</i>
            </a>
          </li>
        </ul>
      </div>
    </nav>

    <!-- Dashboard Content -->
    <div class="container-fluid py-4">

      <!-- Welcome Section -->
      <div class="dashboard-welcome fade-in">
        <h3>Dashboard</h3>
        <p>Turkish-KDS, operasyonel ve finansal performansı gerçek zamanlı olarak izlemek ve stratejik kararları desteklemek amacıyla tasarlanmıştır.</p>
      </div>

      <!-- Stats Row -->
      <div class="row g-3 mb-4">
        <!-- Fuel Price Card -->
        <div class="col-xl-3 col-sm-6">
          <div class="stat-card fade-in">
            <div class="d-flex justify-content-between align-items-start">
              <div class="flex-grow-1">
                <p class="stat-label mb-2">Güncel Brent Kuru</p>
                <h4 class="stat-value mb-2" id="fuel-price">
                  <span class="loading-shimmer" style="display: inline-block; width: 80px; height: 28px; border-radius: 4px;"></span>
                </h4>
                <div id="fuel-price-change-container"></div>
              </div>
              <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <i class="material-symbols-rounded text-white">local_gas_station</i>
              </div>
            </div>
          </div>
        </div>

        <!-- Exchange Rate Card -->
        <div class="col-xl-3 col-sm-6">
          <div class="stat-card fade-in" style="animation-delay: 0.1s;">
            <div class="d-flex justify-content-between align-items-start">
              <div class="flex-grow-1">
                <p class="stat-label mb-2">USD / TRY</p>
                <h4 class="stat-value mb-2" id="exchange-rate">
                  <span class="loading-shimmer" style="display: inline-block; width: 80px; height: 28px; border-radius: 4px;"></span>
                </h4>
                <div id="exchange-rate-change-container"></div>
              </div>
              <div class="stat-icon" style="background: linear-gradient(135deg, #43a047 0%, #66bb6a 100%);">
                <i class="material-symbols-rounded text-white">currency_exchange</i>
              </div>
            </div>
          </div>
        </div>

        <!-- OTP Card -->
        <div class="col-xl-3 col-sm-6">
          <div class="stat-card fade-in" style="animation-delay: 0.2s;">
            <div class="d-flex justify-content-between align-items-start">
              <div class="flex-grow-1">
                <p class="stat-label mb-2">Zamanında Kalkış Oranı</p>
                <h4 class="stat-value mb-2" id="otp-value">
                  <span class="loading-shimmer" style="display: inline-block; width: 80px; height: 28px; border-radius: 4px;"></span>
                </h4>
                <div id="otp-status"></div>
              </div>
              <div class="stat-icon" style="background: linear-gradient(135deg, #fb8c00 0%, #ffa726 100%);">
                <i class="material-symbols-rounded text-white">schedule</i>
              </div>
            </div>
          </div>
        </div>

        <!-- Revenue Card -->
        <div class="col-xl-3 col-sm-6">
          <div class="stat-card fade-in" style="animation-delay: 0.3s;">
            <div class="d-flex justify-content-between align-items-start">
              <div class="flex-grow-1">
                <p class="stat-label mb-2">Brüt Hasılat</p>
                <h4 class="stat-value mb-2" id="annual-revenue">
                  <span class="loading-shimmer" style="display: inline-block; width: 100px; height: 28px; border-radius: 4px;"></span>
                </h4>
                <div id="annual-revenue-delta"></div>
              </div>
              <div class="stat-icon" style="background: linear-gradient(135deg, #e53935 0%, #ef5350 100%);">
                <i class="material-symbols-rounded text-white">paid</i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Global Flight Operations Map -->
      <div class="row g-3 mb-4">
        <div class="col-12">
          <div class="card h-100 fade-in" style="animation-delay: 0.4s;">
            <div class="card-body">
              <div class="section-header">
                <div>
                  <h6 class="section-title">Global Operasyon Haritası</h6>
                  <p class="section-subtitle">Ana Hatlar ve Hub Durumları</p>
                </div>
              </div>
              <div id="flightMap" style="height: 450px; border-radius: 12px; z-index: 1;"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Row 1 -->
      <div class="row g-3 mb-4">

        <!-- Customer Satisfaction -->
        <div class="col-lg-4 col-md-6">
          <div class="card h-100 fade-in" style="animation-delay: 0.5s;">
            <div class="card-body">
              <div class="section-header">
                <div>
                  <h6 class="section-title">Müşteri Memnuniyeti</h6>
                  <p class="section-subtitle">Sınıflara Göre Dağılım</p>
                </div>
              </div>
              <div class="chart-container">
                <canvas id="chart-satisfaction"></canvas>
              </div>
              <hr class="dark horizontal my-2">
              <div class="d-flex align-items-center">
                <i class="material-symbols-rounded text-sm me-1" style="color: var(--success-color);">schedule</i>
                <p class="mb-0 text-sm text-muted">az önce güncellendi</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Flight Occupancy -->
        <div class="col-lg-4 col-md-6">
          <div class="card h-100 fade-in" style="animation-delay: 0.6s;">
            <div class="card-body">
              <div class="section-header">
                <div>
                  <h6 class="section-title">Uçuş Doluluk Oranı</h6>
                  <p class="section-subtitle">Doluluk Analizi</p>
                </div>
                <div class="custom-select">
                  <select id="occupancySelect">
                    <option value="highest" selected>En Yüksek</option>
                    <option value="lowest">En Düşük</option>
                  </select>
                </div>
              </div>
              <div class="chart-container">
                <canvas id="chart-flights"></canvas>
              </div>
              <hr class="dark horizontal my-2">
              <div class="d-flex align-items-center">
                <i class="material-symbols-rounded text-sm me-1" style="color: var(--warning-color);">schedule</i>
                <p class="mb-0 text-sm text-muted">az önce güncellendi</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Revenue Distribution -->
        <div class="col-lg-4 col-md-6">
          <div class="card h-100 fade-in" style="animation-delay: 0.7s;">
            <div class="card-body">
              <div class="section-header">
                <div>
                  <h6 class="section-title">Gelir Dağılımı</h6>
                  <p class="section-subtitle">Kaynaklara Göre</p>
                </div>
                <div class="custom-select">
                  <select id="months-select">
                    <option value="1">1 Ay</option>
                    <option value="6" selected>6 Ay</option>
                    <option value="12">12 Ay</option>
                  </select>
                </div>
              </div>
              <div class="chart-container">
                <canvas id="revenueChart"></canvas>
              </div>
              <hr class="dark horizontal my-2">
              <div id="revenue-legend" class="legend-container"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Row 2 -->
      <div class="row g-3 mb-4">

        <!-- Competitor Prices -->
        <div class="col-lg-8 col-md-12">
          <div class="card h-100 fade-in" style="animation-delay: 0.8s;">
            <div class="card-body">
              <div class="section-header mb-3">
                <div>
                  <h6 class="section-title">Rakip Tarifeler</h6>
                  <p class="section-subtitle">
                    <i class="fa fa-check text-info me-1"></i>
                    <span id="done-count">0 sonuç</span> bulundu
                  </p>
                </div>
                <div class="d-flex align-items-center gap-3">
                  <div>
                    <span class="text-sm text-muted me-2">Önerilen Tarife:</span>
                    <span class="price-highlight" id="suggested-price">-</span>
                  </div>
                  <div class="custom-select">
                    <select id="route-select">
                      <option value="">Rota seçiniz...</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="chart-container" style="height: 280px;">
                <canvas id="competitorBarChart"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- Cost Distribution -->
        <div class="col-lg-4 col-md-6">
          <div class="card h-100 fade-in" style="animation-delay: 0.9s;">
            <div class="card-body">
              <div class="section-header">
                <div>
                  <h6 class="section-title">Maliyet Dağılımı</h6>
                  <p class="section-subtitle">Kategorilere Göre</p>
                </div>
                <div class="custom-select">
                  <select id="months-select-cost">
                    <option value="1">1 Ay</option>
                    <option value="6" selected>6 Ay</option>
                    <option value="12">12 Ay</option>
                  </select>
                </div>
              </div>
              <div class="chart-container">
                <canvas id="costChart"></canvas>
              </div>
              <hr class="dark horizontal my-2">
              <div id="cost-legend" class="legend-container"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <footer class="footer py-4">
        <div class="container-fluid">
          <div class="row align-items-center justify-content-lg-between">
            <div class="col-lg-6 mb-lg-0 mb-4">
              <div class="copyright text-center text-sm text-muted text-lg-start">
                © <script>document.write(new Date().getFullYear())</script>,
                made with <i class="fa fa-heart"></i> by
                <a class="font-weight-bold" target="_blank">KanbolatSoftware</a>
                for a better decision.
              </div>
            </div>
            <div class="col-lg-6">
              <ul class="nav nav-footer justify-content-center justify-content-lg-end">
                <li class="nav-item">
                  <a href="https://www.turkishairlines.com/tr-tr/bilgi-edin/bize-ulasin/" class="nav-link text-muted" target="_blank">Turkish Airlines</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link text-muted" target="_blank">About Us</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link text-muted" target="_blank">Blog</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link pe-0 text-muted" target="_blank">License</a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </footer>
    </div>
  </main>

  <!-- Settings Plugin -->
  <div class="fixed-plugin">
    <a class="fixed-plugin-button text-dark position-fixed px-3 py-2">
      <i class="material-symbols-rounded py-2">settings</i>
    </a>
    <div class="card shadow-lg">
      <div class="card-header pb-0 pt-3">
        <div class="float-start">
          <h5 class="mt-3 mb-0">Arayüz Yapılandırıcısı</h5>
          <p>Gösterge Paneli Seçenekleri</p>
        </div>
        <div class="float-end mt-4">
          <button class="btn btn-link text-dark p-0 fixed-plugin-close-button">
            <i class="material-symbols-rounded">clear</i>
          </button>
        </div>
      </div>
      <hr class="horizontal dark my-1">
      <div class="card-body pt-sm-3 pt-0">
        <div>
          <h6 class="mb-0">Panel Rengi</h6>
        </div>
        <a href="javascript:void(0)" class="switch-trigger background-color">
          <div class="badge-colors my-2 text-start">
            <span class="badge filter bg-gradient-primary" data-color="primary" onclick="sidebarColor(this)"></span>
            <span class="badge filter bg-gradient-dark active" data-color="dark" onclick="sidebarColor(this)"></span>
            <span class="badge filter bg-gradient-info" data-color="info" onclick="sidebarColor(this)"></span>
            <span class="badge filter bg-gradient-success" data-color="success" onclick="sidebarColor(this)"></span>
            <span class="badge filter bg-gradient-warning" data-color="warning" onclick="sidebarColor(this)"></span>
            <span class="badge filter bg-gradient-danger" data-color="danger" onclick="sidebarColor(this)"></span>
          </div>
        </a>
        <div class="mt-3">
          <h6 class="mb-0">Tema</h6>
        </div>
        <div class="d-flex">
          <button class="btn bg-gradient-dark px-3 mb-2" data-class="bg-gradient-dark" onclick="sidebarType(this)">Dark</button>
          <button class="btn bg-gradient-dark px-3 mb-2 ms-2" data-class="bg-transparent" onclick="sidebarType(this)">Transparent</button>
          <button class="btn bg-gradient-dark px-3 mb-2 active ms-2" data-class="bg-white" onclick="sidebarType(this)">White</button>
        </div>
        <hr class="horizontal dark my-3">
        <div class="mt-2 d-flex">
          <h6 class="mb-0">Light / Dark</h6>
          <div class="form-check form-switch ps-0 ms-auto my-auto">
            <input class="form-check-input mt-1 ms-auto" type="checkbox" id="dark-version" onclick="darkMode(this)">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Core JS Files -->
  <script src="../assets/js/core/popper.min.js"></script>
  <script src="../assets/js/core/bootstrap.min.js"></script>
  <script src="../assets/js/plugins/perfect-scrollbar.min.js"></script>
  <script src="../assets/js/plugins/smooth-scrollbar.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="../assets/js/material-dashboard.min.js?v=3.2.0"></script>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    // Enhanced Number Counter Animation
    function animateValue(element, start, end, duration, suffix = '') {
      const range = end - start;
      const increment = range / (duration / 16);
      let current = start;

      const timer = setInterval(() => {
        current += increment;
        if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
          current = end;
          clearInterval(timer);
        }

        if (suffix === '$') {
          element.textContent = suffix + Math.round(current).toLocaleString();
        } else if (suffix === '%') {
          element.textContent = current.toFixed(1) + suffix;
        } else {
          element.textContent = current.toFixed(2) + ' ' + suffix;
        }
      }, 16);
    }

    // Fuel Price
    async function loadFuelPrice() {
      try {
        const res = await fetch('http://localhost:3000/dashboard/fuel-exchange-trends/2');
        const data = await res.json();

        if(data.fuel_prices && data.fuel_prices.length > 0) {
          const prices = data.fuel_prices;
          const latest = prices[prices.length - 1];
          const previous = prices.length > 1 ? prices[prices.length - 2] : null;

          const elem = document.getElementById('fuel-price');
          animateValue(elem, 0, latest.price, 1000, '$');

          if(previous) {
            const change = ((latest.price - previous.price) / previous.price) * 100;
            const changeFormatted = change.toFixed(2) + '%';
            const container = document.getElementById('fuel-price-change-container');
            const changeClass = change > 0 ? 'positive' : 'negative';
            const arrow = change > 0 ? '↑' : '↓';
            container.innerHTML = `<span class="stat-change ${changeClass}">${arrow} ${Math.abs(change).toFixed(2)}%</span>`;
          }
        }
      } catch(err) {
        console.error('Fuel price error:', err);
      }
    }

    // Exchange Rate
    async function loadExchangeRate() {
      try {
        const res = await fetch('http://localhost:3000/dashboard/fuel-exchange-trends/2');
        const data = await res.json();

        if(data.exchange_rate && data.exchange_rate.length > 0) {
          const rates = data.exchange_rate;
          const latest = rates[rates.length - 1];
          const previous = rates.length > 1 ? rates[rates.length - 2] : null;

          const elem = document.getElementById('exchange-rate');
          animateValue(elem, 0, latest.rate, 1000, '₺');

          if(previous) {
            const change = ((latest.rate - previous.rate) / previous.rate) * 100;
            const container = document.getElementById('exchange-rate-change-container');
            const changeClass = change > 0 ? 'positive' : 'negative';
            const arrow = change > 0 ? '↑' : '↓';
            container.innerHTML = `<span class="stat-change ${changeClass}">${arrow} ${Math.abs(change).toFixed(2)}%</span>`;
          }
        }
      } catch(err) {
        console.error('Exchange rate error:', err);
      }
    }

    // OTP
    async function loadOtpCard() {
      try {
        const res = await fetch("http://localhost:3000/dashboard/otp");
        const data = await res.json();
        const otp = data.otp;

        const elem = document.getElementById("otp-value");
        animateValue(elem, 0, otp, 1000, '%');

        const statusElem = document.getElementById("otp-status");
        if (otp >= 85) {
          statusElem.innerHTML = `<span class="status-badge excellent">Excellent - Mükemmel</span>`;
        } else if (otp >= 70) {
          statusElem.innerHTML = `<span class="status-badge moderate">Moderate - Orta</span>`;
        } else {
          statusElem.innerHTML = `<span class="status-badge poor">Poor - Düşük</span>`;
        }
      } catch (err) {
        console.error("OTP error:", err);
      }
    }

    // Annual Revenue
    async function loadAnnualRevenue() {
      try {
        const res = await fetch("http://localhost:3000/dashboard/annual-revenue");
        const data = await res.json();

        const elem = document.getElementById("annual-revenue");
        animateValue(elem, 0, data.this_year_revenue, 1500, '$');

        const deltaElem = document.getElementById("annual-revenue-delta");
        const changeClass = data.delta >= 0 ? 'positive' : 'negative';
        const arrow = data.delta >= 0 ? '↑' : '↓';
        deltaElem.innerHTML = `<span class="stat-change ${changeClass}">${arrow} ${Math.abs(data.delta)}% yıllık</span>`;
      } catch (err) {
        console.error("Revenue error:", err);
      }
    }

    // Customer Satisfaction
    let satisfactionChart = null;
    async function loadSatisfactionScores() {
      try {
        const res = await fetch('http://localhost:3000/dashboard/satisfaction-score');
        const data = await res.json();

        const labels = data.satisfactionScores.map(item => item.membership_type);
        const scores = data.satisfactionScores.map(item => parseFloat(item.avg_loyalty_score));

        const ctx = document.getElementById("chart-satisfaction").getContext("2d");

        if(satisfactionChart) satisfactionChart.destroy();

        satisfactionChart = new Chart(ctx, {
          type: "bar",
          data: {
            labels: labels,
            datasets: [{
              label: "Memnuniyet Skoru",
              data: scores,
              backgroundColor: 'rgba(67, 160, 71, 0.8)',
              borderRadius: 8,
              barThickness: 24
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: {
                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                padding: 12,
                titleFont: { size: 14 },
                bodyFont: { size: 13 },
                cornerRadius: 8
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                max: 100,
                grid: { color: 'rgba(0,0,0,0.05)' },
                ticks: { font: { size: 11 } }
              },
              x: {
                grid: { display: false },
                ticks: { font: { size: 11 } }
              }
            },
            animation: {
              duration: 1000,
              easing: 'easeOutQuart'
            }
          }
        });
      } catch (err) {
        console.error('Satisfaction error:', err);
      }
    }

    // Flight Occupancy
    let flightChart = null;
    async function fetchAndRenderFlights(typeParam) {
      try {
        const res = await fetch(`http://localhost:3000/dashboard/flights-by-occupancy/${typeParam}`);
        const data = await res.json();

        const labels = data.flights.map(f => f.flight_number);
        const occupancyData = data.flights.map(f => parseFloat(f.occupancy_rate));

        const ctx = document.getElementById("chart-flights").getContext("2d");

        if (flightChart) flightChart.destroy();

        flightChart = new Chart(ctx, {
          type: "line",
          data: {
            labels: labels,
            datasets: [{
              label: "Doluluk Oranı (%)",
              data: occupancyData,
              tension: 0.4,
              borderWidth: 3,
              pointRadius: 5,
              pointHoverRadius: 7,
              pointBackgroundColor: "#fb8c00",
              pointBorderColor: "white",
              pointBorderWidth: 2,
              borderColor: "#fb8c00",
              backgroundColor: "rgba(251, 140, 0, 0.1)",
              fill: true
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: {
                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                padding: 12,
                cornerRadius: 8
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                max: 100,
                grid: { color: 'rgba(0,0,0,0.05)' }
              },
              x: { grid: { display: false } }
            },
            animation: {
              duration: 1200,
              easing: 'easeOutQuart'
            }
          }
        });
      } catch(err) {
        console.error(err);
      }
    }

    document.getElementById("occupancySelect").addEventListener("change", (e) => {
      fetchAndRenderFlights(e.target.value);
    });

    // Revenue Distribution
    let revenueChart = null;
    async function loadRevenueChart(months) {
      try {
        const res = await fetch(`http://localhost:3000/dashboard/revenue-by-months?months=${months}`);
        const data = await res.json();

        const revenueData = [
          data.ticket_sales ? parseFloat(data.ticket_sales) : 0,
          data.cargo_revenue ? parseFloat(data.cargo_revenue) : 0,
          data.other_revenue ? parseFloat(data.other_revenue) : 0
        ];

        const labels = ["Bilet", "Kargo", "Diğer"];
        const colors = ['#1976d2', '#43a047', '#fb8c00'];

        const ctx = document.getElementById('revenueChart').getContext('2d');

        if (revenueChart) revenueChart.destroy();

        revenueChart = new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: labels,
            datasets: [{
              data: revenueData,
              backgroundColor: colors,
              borderWidth: 4,
              borderColor: '#fff'
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: {
                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                padding: 12,
                cornerRadius: 8,
                callbacks: {
                  label: function(context) {
                    const val = context.parsed;
                    const sum = revenueData.reduce((a,b) => a+b, 0);
                    const percent = sum ? (val/sum*100).toFixed(1) : 0;
                    return `₺${val.toLocaleString('tr-TR')} (${percent}%)`;
                  }
                }
              }
            },
            cutout: '65%',
            animation: {
              animateRotate: true,
              duration: 1200
            }
          }
        });

        // Legend
        const legendDiv = document.getElementById('revenue-legend');
        legendDiv.innerHTML = '';
        const sum = revenueData.reduce((a,b)=>a+b,0) || 1;
        revenueData.forEach((val, idx) => {
          const percent = ((val/sum)*100).toFixed(1) + '%';
          const item = document.createElement('div');
          item.classList.add('legend-item');
          item.innerHTML = `
            <span class="legend-color" style="background:${colors[idx]}"></span>
            <span class="legend-label">${labels[idx]}</span>
            <span class="legend-percent">${percent}</span>
          `;
          legendDiv.appendChild(item);
        });

      } catch (err) {
        console.error('Revenue chart error:', err);
      }
    }

    const monthsSelect = document.getElementById('months-select');
    monthsSelect.addEventListener('change', () => loadRevenueChart(monthsSelect.value));

    // Competitor Prices
    const routeSelect = document.getElementById('route-select');
    const doneCount = document.getElementById('done-count');
    const suggestedPriceElem = document.getElementById('suggested-price');
    let competitorChart = null;

    function formatTL(v) {
      return Number(v).toLocaleString('tr-TR') + ' ₺';
    }

    async function loadRoutes() {
      try {
        const res = await fetch('http://localhost:3000/dashboard/routes');
        const routes = await res.json();

        routeSelect.querySelectorAll('option:not(:first-child)').forEach(o => o.remove());

        routes.forEach((route) => {
          const option = document.createElement('option');
          option.value = route.id;
          option.textContent = route.route;
          routeSelect.appendChild(option);
        });

        const defaultRoute = routes.find(r => r.id === 2) || routes[0];
        if(defaultRoute) {
          routeSelect.value = defaultRoute.id;
          await loadRouteData(defaultRoute.id);
        }
      } catch (err) {
        console.error('Routes error:', err);
      }
    }

    async function loadRouteData(flightId) {
      if(!flightId) return;

      try {
        const [pricesRes, suggestedRes] = await Promise.all([
          fetch(`http://localhost:3000/dashboard/competitor-prices/${flightId}`),
          fetch(`http://localhost:3000/dashboard/suggested-price/${flightId}`)
        ]);
        const prices = await pricesRes.json();
        const suggestedData = await suggestedRes.json();

        doneCount.textContent = `${prices.length} sonuç`;

        const suggestedPrice = suggestedData?.suggested_price ?? null;
        suggestedPriceElem.textContent = suggestedPrice ? formatTL(suggestedPrice) : '-';

        updateCompetitorChart(prices, suggestedPrice);
      } catch (err) {
        console.error('Route data error:', err);
      }
    }

    function updateCompetitorChart(prices, ourPrice) {
      if(!prices || prices.length === 0) {
        if(competitorChart) competitorChart.destroy();
        return;
      }

      const items = prices.map(p => ({
        name: p.competitor_name,
        price: Number(p.price),
        isUs: false
      }));

      if(ourPrice !== null && !isNaN(Number(ourPrice))) {
        items.push({
          name: 'Önerilen Tarife',
          price: Number(ourPrice),
          isUs: true
        });
      }

      items.sort((a,b) => b.price - a.price);

      const labels = items.map(i => i.name);
      const data = items.map(i => i.price);
      const colors = items.map(i => i.isUs ? 'rgba(67, 160, 71, 0.9)' : 'rgba(108, 117, 125, 0.7)');

      if(competitorChart) competitorChart.destroy();

      const ctx = document.getElementById('competitorBarChart').getContext('2d');
      competitorChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels,
          datasets: [{
            label: 'Fiyat',
            data,
            backgroundColor: colors,
            borderRadius: 8,
            barThickness: 20
          }]
        },
        options: {
          indexAxis: 'y',
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: {
              ticks: {
                callback: function(value) { return value + ' ₺'; }
              },
              grid: { color: 'rgba(0,0,0,0.05)' }
            },
            y: {
              grid: { display: false }
            }
          },
          plugins: {
            legend: { display: false },
            tooltip: {
              backgroundColor: 'rgba(0, 0, 0, 0.8)',
              padding: 12,
              cornerRadius: 8,
              callbacks: {
                label: function(ctx) {
                  return formatTL(ctx.parsed.x);
                }
              }
            }
          },
          animation: {
            duration: 1000,
            easing: 'easeOutQuart'
          }
        }
      });
    }

    routeSelect.addEventListener('change', () => {
      const flightId = routeSelect.value;
      loadRouteData(flightId);
    });

    // Cost Distribution
    let costChart = null;
    async function loadCostChart(months) {
      try {
        const res = await fetch(`http://localhost:3000/dashboard/cost-by-months?months=${months}`);
        const data = await res.json();

        const costData = [
          data.fuel_cost ? parseFloat(data.fuel_cost) : 0,
          data.staff_cost ? parseFloat(data.staff_cost) : 0,
          data.maintenance_cost ? parseFloat(data.maintenance_cost) : 0,
          data.other_costs ? parseFloat(data.other_costs) : 0
        ];

        const labels = ["Yakıt", "Personel", "Bakım", "Diğer"];
        const colors = ['#1976d2', '#43a047', '#fb8c00', '#e53935'];

        const ctx = document.getElementById('costChart').getContext('2d');

        if(costChart) costChart.destroy();

        costChart = new Chart(ctx, {
          type: 'polarArea',
          data: {
            labels: labels,
            datasets: [{
              data: costData,
              backgroundColor: colors.map(c => c + '99'),
              borderWidth: 2,
              borderColor: '#fff'
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: {
                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                padding: 12,
                cornerRadius: 8,
                callbacks: {
                  label: function(context) {
                    const val = context.parsed.r;
                    const sum = costData.reduce((a,b)=>a+b,0);
                    const percent = sum ? (val/sum*100).toFixed(1) : 0;
                    return `₺${val.toLocaleString('tr-TR')} (${percent}%)`;
                  }
                }
              }
            },
            scales: {
              r: {
                ticks: { display: false },
                grid: { color: 'rgba(0,0,0,0.1)' }
              }
            },
            animation: {
              duration: 1200,
              easing: 'easeOutQuart'
            }
          }
        });

        // Legend
        const legendDiv = document.getElementById('cost-legend');
        legendDiv.innerHTML = '';
        const sum = costData.reduce((a,b)=>a+b,0) || 1;
        costData.forEach((val, idx) => {
          const percent = ((val/sum)*100).toFixed(1) + '%';
          const item = document.createElement('div');
          item.classList.add('legend-item');
          item.innerHTML = `
            <span class="legend-color" style="background:${colors[idx]}"></span>
            <span class="legend-label">${labels[idx]}</span>
            <span class="legend-percent">${percent}</span>
          `;
          legendDiv.appendChild(item);
        });

      } catch(err){
        console.error('Cost chart error:', err);
      }
    }

    const monthsSelectCost = document.getElementById('months-select-cost');
    monthsSelectCost.addEventListener('change', () => loadCostChart(monthsSelectCost.value));

    // Global Flight Operations Map
    let flightMap = null;
    async function loadFlightMap() {
      try {
        // Initialize Leaflet map
        flightMap = L.map('flightMap', {
          center: [39, 35],
          zoom: 3,
          zoomControl: true,
          scrollWheelZoom: true
        });

        // Add dark themed tile layer
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
          attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
          subdomains: 'abcd',
          maxZoom: 19
        }).addTo(flightMap);

        // Fetch map data
        const res = await fetch('http://localhost:3000/dashboard/map-data');
        const data = await res.json();

        // Create a map to store hub locations
        const hubLocations = new Map();

        // First, extract hub locations from routes
        if (data.routes && data.routes.length > 0) {
          data.routes.forEach(route => {
            if (!hubLocations.has(route.origin.iata)) {
              hubLocations.set(route.origin.iata, {
                lat: route.origin.lat,
                lon: route.origin.lon,
                iata: route.origin.iata
              });
            }
            if (!hubLocations.has(route.destination.iata)) {
              hubLocations.set(route.destination.iata, {
                lat: route.destination.lat,
                lon: route.destination.lon,
                iata: route.destination.iata
              });
            }
          });
        }

        // Render Routes
        if (data.routes && data.routes.length > 0) {
          data.routes.forEach(route => {
            const origin = [route.origin.lat, route.origin.lon];
            const destination = [route.destination.lat, route.destination.lon];
            const profitability = route.profitability;

            // Determine line style based on profitability
            let lineColor, lineWeight, lineDashArray;

            if (profitability > 0) {
              lineColor = '#66bb6a';
              lineWeight = 3;
              lineDashArray = null;
            } else if (profitability < 0) {
              lineColor = '#ef5350';
              lineWeight = 2;
              lineDashArray = null;
            } else {
              lineColor = '#6c757d';
              lineWeight = 2;
              lineDashArray = '5, 5';
            }

            // Create polyline
            const polyline = L.polyline([origin, destination], {
              color: lineColor,
              weight: lineWeight,
              opacity: 0.7,
              dashArray: lineDashArray
            }).addTo(flightMap);

            // Format profitability
            const profitClass = profitability > 0 ? 'positive' : profitability < 0 ? 'negative' : 'neutral';
            const profitFormatted = profitability.toLocaleString('tr-TR');

            // Add popup
            const popupContent = `
              <div class="map-popup-title">${route.origin.iata} → ${route.destination.iata}</div>
              <div class="map-popup-profit ${profitClass}">
                Karlılık: ₺${profitFormatted}
              </div>
            `;

            polyline.bindPopup(popupContent);
          });
        }

        // Render Hubs
        if (data.hubs && data.hubs.length > 0) {
          data.hubs.forEach(hub => {
            const location = hubLocations.get(hub.iata);

            if (location) {
              // Determine hub color based on status
              let hubColor;
              let statusText;

              if (hub.status === 'green') {
                hubColor = '#43a047';
                statusText = 'Excellent';
              } else if (hub.status === 'yellow') {
                hubColor = '#fb8c00';
                statusText = 'Moderate';
              } else {
                hubColor = '#6c757d';
                statusText = 'Normal';
              }

              // Create circle marker for hub
              const circleMarker = L.circleMarker([location.lat, location.lon], {
                radius: 10,
                fillColor: hubColor,
                color: '#fff',
                weight: 3,
                opacity: 1,
                fillOpacity: 0.9
              }).addTo(flightMap);

              // Add popup
              const hubPopupContent = `
                <div class="map-popup-title">${hub.iata} Hub</div>
                <div class="map-popup-detail">Status: ${statusText}</div>
              `;

              circleMarker.bindPopup(hubPopupContent);
            }
          });
        }

        // Add smooth animation on load
        setTimeout(() => {
          flightMap.invalidateSize();
        }, 500);

      } catch (err) {
        console.error('Flight map error:', err);
      }
    }

    // Initialize All
    document.addEventListener('DOMContentLoaded', () => {
      loadFuelPrice();
      loadExchangeRate();
      loadOtpCard();
      loadAnnualRevenue();
      loadFlightMap();
      loadSatisfactionScores();
      fetchAndRenderFlights('highest');
      loadRevenueChart(6);
      loadRoutes();
      loadCostChart(6);
    });

    // Smooth Scrollbar
    var win = navigator.platform.indexOf('Win') > -1;
    if (win && document.querySelector('#sidenav-scrollbar')) {
      var options = { damping: '0.5' }
      Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
    }
  </script>
</body>

</html>
